# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура приложения
Архитектура приложения разработана в парадигме MVP.\
Выделены слои:
- Слой данных -данные, с  которыми работает приложение, 
- Слой представления - отвечает за отоброжение;
- Слой презентера - организовывает связь между данными и отображением;
## Данные и типы данных используемые в приложении 

Карточка товара

```
interface ICard {
  id: string;
  description?: string;
  image: string;
  title: string;
  category: string;
  price: number;
  <!-- basket: boolean; -->
}
```
Пользователь
```
interface IUser {
  email: string;
  phone: string;
  payment: string;
  address: string;
}

```

сохранение масс карточек отложенных в корзину
```
export interface IBascetData {
  cardsbasret: ICard[]
}
```

Интерфейс для хранения массива товаров

```
interface ICardData {
  cards: ICard[];
  preview: string | null;
  addCard(card: ICard): void;
  deleteCard(cardId: string, payload: Function | null): void;
  <!-- updateCard(card: ICard, payload: Function | null): void; -->
  getCard(cardId: string): ICard
}
```

Работа с данными Пользователя: сохранение, получение, валидация
```
interface IUserData {
  getUserInfo():IOrderFormContact & IOrderFormOption;
  setUserInfo(userData: IUser): void;
  chackUserValidation(data: Record<keyof IUser, string>): boolean
}
```
Данные карточки, используемые в модальном окне для просмотра отложенных товаров в корзину

```
type ICardBascet = Pick<ICard, 'title' | 'price' | 'id'>
```
Данные пользователя, используемые в форме ввода контактов

```
type IFormContact = Pick<IUser, 'email' | 'phone'>
```
Данные пользователя,  используемые в форме ввода данных оплаты и доставки

```
type IOrderForm = Pick<IUser, 'payment' | 'address'>
```

Массив для отправки данных пользователя на сервер
```
interface IOrder extends IFormContact, IOrderForm, IBidprice {
  items: string[]
}
```

Получает общую сумму заказа
```
interface IBidprice {
  total: number
}
```
```
interface IOrderResult {
  id: string;
  total: number
}
```

## Базовый код
#### Класс Api 
Предоставляет инструменты для работы с сервером.
В конструкторе принимает базовый URL для запроса на сервер и опциональный объект с заголовками запросов.
Реализует методы 
- `get` - выполняет `GET` запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер,
- `post` - принимает объект с данными, которые будут переданы в `JSON` тела запроса и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняет `POST` запрос, но может быть переопределен третьим параметром при вызове.

#### Класс Component
Необходим для работы с разметкой. Является  дженериком и родительских для всех компонентов слоя представления.
В конструкторе принимает контейнер `container: HTMLElement` - контейнер, с которым будет построена работа.
Реализует методы:
 - `toggleClass` - Переключения класса;
 - `setText` - Установка текстового содержимого;
 - `setDisabled` -Меняет статус блокировки;
 - `setHidden` и `setVisible` - Скрывает и показывает элемент разметки;
 - `setImage` Устанавливает изображение с алтернативным текстом;
 - `render` - Возвращает корневой DOM-элемент.

#### Класс EventEmitter
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы 
- `on` — для подписки на событие,
- `off` — отписки от события,  
- `emit` — уведомления подписчиков о наступлении события.
Дополнительно реализованы методы  
- `onAll` — для подписки на все события
- `offAll`  —  и сброса всех подписчиков.

Интересным дополнением является метод  `trigger`, генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от класса  `EventEmitter`.

## Слой данных (бизнес-логика)
 ### Класс CardsData 
 Класс отвечает за хранение карточек товаров.\
 Конструктор класса принимает инстант Брокера событий ??????\
 В полях класса хранятся данные:
 - _cards: ICard[] Массив объектов карточек;
 - _preview: string | null id карточки, выбранной для загрузки в модальное окно;
 - events: IEvents - экземпляр класса `EventEmitter`, для генерации событий при изменении данных;

Методы для взаимодействия с этими данными:
 - addCard(card: ICard): void Добавляет карточку в конец массива и вызывает событие изменение массива;
 - deleteCard(cardId: string, payload: Function | null): void удаляет карточку из массива;
 <!-- - updateCard(card: ICard, payload: Function | null): void обновляет данные карточки в массиве; -->
 - getCard(cardId: string): ICard возвращает карточку по ее id;

 ### Класс UserData
 Класс отвечает за хранение и логику работы с данными пользователя.
 Конструктор класса принимает инстант Брокера событий ??????\
 В полях класса хранятся данные:
  - email: string електронная почта;
  - phone: string Телефон;
  - payment: string способ оплаты, предпочитаемый пользователем;
  - address: string адрес доставки;

  Методы для взаимодействия с этими данными:
   - getUserInfo():IOrderFormContact & IOrderFormOption возвращает данные, указанные пользователем;
   - setUserInfo(userData: IUser): void сохраняет данные пользователя;
   <!-- - chackUserValidation(data: Record<keyof IUser, string>): boolean проверяет введенные данные на валидность; -->

   <!-- ### Класс Basket -->

## Компоненты представления
### Класс Card 
Класс отвечает за отображение карточек на странице.\
В конструкторе передается DOM-элемент template, позволяя при необходимости формировать карточки разных вариантов верстки. Так же принимает экземпляр `EventEmitter` для иницилизации событий.\
В классе устанавливаются слушатели событий на интерактивные элемнты, с которыми может взаимодействовать пользователь, в результате которого генерируется событие.\
Поля класса содержат элементы разметки карточек.

Методы:
- через сеттеры  заполняет поля каждой из карточек и сохраняет id каждой;
- deleteCard(): void - метод для удаления карточки из массива выбранных;
- геттер id - возвращает уникальный id карточки.

### Класс CardsContainer
Отвечает за отображение блока карточек на главной странице. В конструкторепринимает контейнер в котором размещаются карточки.Метод render наследует от базового класса component.

### Класс modal
Реализует модальное окно. Предоставляет Методы `open` и `close` для управления открытием и закрытием модального окна. Устанавливает слушатели для закрытия модального окна (крестик, ESC, оверлей)
- ` constructor(container: HTMLElement, protected events: IEvents)` Конструктор принимает объект содержимого модального окна  и `EventEmitter`, для генерации событий при изменениях;

Поля класса:
- modal: HTMLElement - разметка модального окна;
- events: IEvents - Брокер событий;
- closeButton: HTMLButtonElement - кнопка закрытия модального окна;

### Класс Basket 
Конструктор класса принимает темплейт содержимого корзины и `EventEmitter`, для генерации событий при изменениях и самбите; Устанавливает слушатели событий корзины. В полях класса хранится массив карточек, находящихся в корзине, общую сумму покупки, и кнопки удаления и оформления заказа:
 - list: HTMLElement;
 - _total: HTMLElement;
 - _button: HTMLElement;
Реализует сеттеры для обновления списка карточек и суммы покупки. 

### Класс Form
Конструктор класса принимает темплейт содержимого формы и `EventEmitter`, для генерации событий при изменениях; Устанавливает слушатели событий на вводимое значение в инпут и кнопки. В полях класса хранит кнопки  и массив ошибок валидации. Резализует сеттеры значения валидности и вывода ошибки.
предоставляетя метод `onInputChange` для генерации события изменения вводимого значения. Расширяет родительский метод `render` заполняя поля значениямо из `error`.

### Класс Success
Конструктор класса принимает темплейт успешного оформления заказа и `EventEmitter`, для генерации событий при изменениях. Устанавливает слушатель на кнопку "за новыми покупками".

## Интерфейс API-клиента
### Класс AppApi
Наследует класс Api. Принимает в конструктор базовый адрес для запроса на сервер и CDN для получения картинки. Предоставляет методы для взаимодействия с бекендом сервиса:
- getCardItem(id: string): Promise<ICard> - запрос карточки по id;
- getCardList(): Promise<ICard[]> - получение списка карточек;
- order(order: IOrder): Promise<IOrderResult> - отправка даннных заказа на сервер;

## Брокер событий 
### Взаимодействие компонентов
Код, описывающий взаимодействовие представления и данных между собой находится в файле index.ts и выполняет роль презентера.
Взаимодействие осуществляется за счет генерируемых событий и их обработчиков.
Сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.\
События изменения данных:
- `cards:changed` - изменение массива карточек;
- `cards:basket` - изменение массива отложенных в корзину карточек;
- `user:changed` - изменение данных пользователя

События возникающие при взаимодействии пользователя с интерфейсом:
- `card:click` - клик по карточке, для открытия ее в модальном окне;
- `card:basket` - клик по кнопке отложить/удалить карточку в/из корзины;
- `modal:open` - открытие модального окнаж
- `modal:close` -  закрытие модального окна;
- `basket:click` - открытие корзины;
- `card:delete` - удаление карточки из корзины;
- `button:alt` - клик по кнопке выбора способа оплаты;
- `input:address` - изменение поля адреса доставки;
- `input:contact` - изменение контактных данных покупателя;
- `form:submit` - подтверждение оформления заказа и переход к следующей форме;
- `form:validation` - событие сообщающеенеобходимость валидации данных формы;
- `card:clear` - событие сообщающее необходимость обновления данных карточке отложенных в корзину;



